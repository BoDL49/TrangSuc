@model WebTrangSuc.Models.TaiKhoan

@{
    ViewBag.Title = "Author";
    Layout = "~/Views/Shared/_MasterLayout.cshtml";
}
<div class="w-full max-w-4xl bg-white rounded-2xl shadow-2xl overflow-hidden mt-72 mx-72">
    <div class="flex flex-col md:flex-row">
        <div class="w-full md:w-1/2 p-8">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800">Welcome Back! 👋</h2>
                <p class="text-gray-600 mt-2">Hãy đăng nhập tài khoản của bạn</p>
            </div>
            <form class="space-y-6" id="loginForm">
                @Html.AntiForgeryToken()
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1" for="email">Email hoặc Username</label>
                    <input type="text" id="email" name="Username" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="Email hoặc Username của bạn" required>
                </div>
                <div class="relative">
                    <label class="block text-sm font-medium text-gray-700 mb-1" for="password">Mật Khẩu</label>
                    <div class="relative">
                        <input type="password" id="password" name="Password" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="Nhập mật khẩu" required>
                        <button type="button" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700" id="hidden">👁️</button>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <label class="flex items-center">
                        <input type="checkbox" id="rememberMe" class="w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                        <span class="ml-2 text-sm text-gray-600">Lưu thông tin</span>
                    </label>
                    <a href="Auth/QuenMatKhau" class="text-sm text-blue-600 hover:underline">Quên mật khẩu?</a>
                </div>
                <button type="submit" id="dangnhap" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all">
                    <span class="inline-flex items-center">Đăng nhập <span class="ml-2">➡️</span></span>
                </button>
<div id="error-message" class="text-red-500 text-sm mt-2 hidden"></div>
<div id="success-message" class="text-green-500 text-sm mt-2 hidden"></div>
            </form>
        </div>
        <div class="w-full md:w-1/2 p-8 bg-gradient-to-br from-blue-500 to-purple-600">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-white">Tạo tài khoản ✨</h2>
                <p class="text-blue-100 mt-2">Tạo tài khoản mới cho bạn</p>
            </div>
            <form class="space-y-4" id="RegisForm">
                @Html.AntiForgeryToken()
                <div class="flex space-x-4">
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-white mb-1">Họ và tên</label>
                        <input type="text" name="HoVaTen" tabindex="1" class="w-full px-4 py-3 rounded-lg border border-transparent focus:ring-2 focus:ring-white focus:border-white transition-all bg-blue-600/50 text-white placeholder-blue-200" placeholder="Trần Văn A" required>
                    </div>
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-white mb-1">Giới Tính</label>
                        <select name="GioiTinh" tabindex="2" class="w-full px-4 py-3 rounded-lg border border-transparent focus:ring-2 focus:ring-white focus:border-white transition-all bg-blue-600/50 text-white placeholder-blue-200">
                            <option value="">Chọn giới tính</option>
                            <option value="Nam">Nam</option>
                            <option value="Nữ">Nữ</option>
                            <option value="Khác">Khác</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-white mb-1">Ngày Sinh</label>
                    <input type="date" name="NamSinh" tabindex="3" class="w-full px-4 py-3 rounded-lg border border-transparent focus:ring-2 focus:ring-white focus:border-white transition-all bg-blue-600/50 text-white placeholder-blue-200" required>
                </div>

                <div>
                    <label class="block text-sm font-medium text-white mb-1">UserName</label>
                    <input type="text" name="UserName" tabindex="4" class="w-full px-4 py-3 rounded-lg border border-transparent focus:ring-2 focus:ring-white focus:border-white transition-all bg-blue-600/50 text-white placeholder-blue-200" placeholder="abc" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-white mb-1">Email Address</label>
                    <input type="Email" name="email" tabindex="5" class="w-full px-4 py-3 rounded-lg border border-transparent focus:ring-2 focus:ring-white focus:border-white transition-all bg-blue-600/50 text-white placeholder-blue-200" placeholder="you@example.com" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-white mb-1">Mật khẩu</label>
                    <div class="relative">
                        <input type="password" tabindex="6" name="Matkhau" id="passwordRes" class="w-full px-4 py-3 rounded-lg border border-transparent focus:ring-2 focus:ring-white focus:border-white transition-all bg-blue-600/50 text-white placeholder-blue-200" placeholder="Nhập mật khẩu" required>
                        <button type="button"  class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700" id="reshidden">👁️</button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-white mb-1">Xác nhận lại mật khẩu</label>
                    <div class="relative">
                        <input type="password" tabindex="7" name="XacNhanMatKhau" id="RepasswordRes" class="w-full px-4 py-3 rounded-lg border border-transparent focus:ring-2 focus:ring-white focus:border-white transition-all bg-blue-600/50 text-white placeholder-blue-200" placeholder="Xác nhận lại mật khẩu" required>
                        <button type="button"  class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700" id="rereshidden">👁️</button>
                    </div>

                </div>
                <button type="submit" id="dangky" class="w-full bg-white text-blue-600 py-3 rounded-lg font-semibold hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 transition-all">
                    <span class="inline-flex items-center">Tạo tài khoản<span class="ml-2">✨</span></span>
                </button>
            </form>
        </div>
    </div>
</div>

<script>
    document.getElementById("RegisForm").addEventListener("submit", function (event) {
        event.preventDefault();

        const formData = new FormData(this);
        const data = {};
        formData.forEach((value, key) => {
            data[key] = value;
        });

        const messageDiv = document.getElementById("error-message");
        const successDiv = document.getElementById("success-message"); 

        fetch('/api/taikhoan/dangky', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
            },
            body: JSON.stringify(data)

        })
            .then(response => {
                messageDiv.classList.add("hidden"); 
                successDiv.classList.add("hidden");

                if (!response.ok) {
                    return response.json().then(errorData => {
                        messageDiv.textContent = errorData.Message || "Đăng ký thất bại. Vui lòng thử lại.";
                        messageDiv.classList.remove("hidden");
                        messageDiv.classList.remove("text-green-500"); 
                        messageDiv.classList.add("text-red-500");    
                        throw new Error(errorData.Message || "Đăng ký thất bại.");
                    });
                }
                return response.json();
            })
            .then(result => {
                successDiv.textContent = result.message || "Đăng ký thành công!"; 
                successDiv.classList.remove("hidden"); 
                successDiv.classList.remove("text-red-500");
                successDiv.classList.add("text-green-500"); 
                this.reset();
                messageDiv.classList.add("hidden"); 
            })
    }); 


    document.getElementById("loginForm").addEventListener("submit", function (event) {
        event.preventDefault();

        const formData = new FormData(this);
        const data = {};
        formData.forEach((value, key) => {
            data[key] = value;
        });

        const messageDiv = document.getElementById("error-message");
        const successDiv = document.getElementById("success-message");

        fetch('/api/taikhoan/dangnhap', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
            .then(response => {
                messageDiv.classList.add("hidden");
                successDiv.classList.add("hidden");

                if (!response.ok) {
                    return response.json().then(errorData => {
                        messageDiv.textContent = errorData.Message || "Đăng nhập thất bại. Vui lòng thử lại.";
                        messageDiv.classList.remove("hidden");
                        messageDiv.classList.add("text-red-500");
                        throw new Error(errorData.Message || "Đăng nhập thất bại.");
                    });
                }
                return response.json();
            })
            .then(data => {
                if (data.token) {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('userId', data.userId);
                    localStorage.setItem('role', data.role);

                    if (document.getElementById("rememberMe").checked) {
                        localStorage.setItem("rememberMe", "true");
                        localStorage.setItem("email", formData.get("Username"));
                        localStorage.setItem("password", formData.get("Password"));
                    } else {
                        localStorage.removeItem("rememberMe");
                        localStorage.removeItem("email");
                        localStorage.removeItem("password");
                    }

                    window.location.href = '/';
                } else {
                    console.error("Login failed:", data);
                }
            })
            .catch(error => console.error("Error:", error));
    });


    document.addEventListener("DOMContentLoaded", function () {
        if (localStorage.getItem("rememberMe") === "true") {
            document.getElementById("email").value = localStorage.getItem("email");
            document.getElementById("password").value = localStorage.getItem("password");
            document.getElementById("rememberMe").checked = true;
        }
    });


    document.getElementById("hidden").addEventListener("click", function () {
        const passwordInput = document.getElementById("password");
        if (passwordInput.type === "password") {
            passwordInput.type = "text";
            this.textContent = "🙈";
        } else {
            passwordInput.type = "password";
            this.textContent = "👁️";
        }
    });

    document.getElementById("reshidden").addEventListener("click", function () {
        const passwordRes = document.getElementById("passwordRes");
        if (passwordRes.type === "password") {
            passwordRes.type = "text";
            this.textContent = "🙈";
        } else {
            passwordRes.type = "password";
            this.textContent = "👁️";
        }
    });


    document.getElementById("rereshidden").addEventListener("click", function () {
        const RepasswordRes = document.getElementById("RepasswordRes");
        if (RepasswordRes.type === "password") {
            RepasswordRes.type = "text";
            this.textContent = "🙈";
        } else {
            RepasswordRes.type = "password";
            this.textContent = "👁️";
        }
    });



    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const rememberMeCheckbox = document.getElementById("rememberMe");

    document.addEventListener("DOMContentLoaded", function () {
        if (localStorage.getItem("rememberMe") === "true") {
            emailInput.value = localStorage.getItem("email");
            passwordInput.value = localStorage.getItem("password");
            rememberMeCheckbox.checked = true;
        }
    });

   
</script>
